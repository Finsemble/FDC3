{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://fdc3.finos.org/schemas/next/bridging/bridgeResponse.schema.json",
  "title": "Bridge Response Message",
  "type": "object",
  "description": "A response message from the Bridge back to the original Desktop Agent that raised the request.",
  "properties": {
    "type": {
      "title": "Response Message Type",
      "type": "string",
      "description": "Identifies the type of the message and it is typically set to the FDC3 function name that the message relates to, e.g. 'findIntent', with 'Response' appended."
    },
    "payload": {
      "title": "Response Message Payload",
      "type": "object",
      "description": "The message payload typically contains return values for FDC3 API functions."
    },
    "meta": {
      "$ref": "#/$defs/BridgeResponseMeta"
    }
  },
  "required": ["type", "payload", "meta"],
  "additionalProperties": false,
  "$defs": {
    "BridgeResponseMeta": {
      "title": "Bridge Response Metadata",
      "description": "Metadata required in a response message collated and/or forwarded on by the Bridge",
      "type": "object",
      "properties": {
        "requestUuid": {
          "type": "string",
          "description": "UUID for the request this message is responding to"
        },
        "responseUuid": {
          "type": "string",
          "description": "UUID for the response"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp at which the response was generated"
        },
        "sources": {
          "type": "array",
          "items": [
            {
              "$ref": "bridgeParticipantIdentifier.schema.json"
            }
          ],
          "title": "Desktop Agents that responded",
          "description": "Array of AppIdentifiers or DesktopAgentIdentifiers for the sources that generated responses to the request. Will contain a single value for individual responses and multiple values for responses that were collated by the bridge. May be omitted if all sources errored. MUST include the `desktopAgent` field when returned by the bridge."
        },
        "errorSources": {
          "type": "array",
          "items": [
            {
              "$ref": "bridgeParticipantIdentifier.schema.json"
            }
          ],
          "title": "Desktop Agents that errored",
          "description": "Array of AppIdentifiers or DesktopAgentIdentifiers for responses that were not returned to the bridge before the timeout or because an error occurred. May be omitted if all sources responded without errors."
        },
        "errorDetails": {
          "title": "Detail of errors returned",
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Array of error message strings for responses that were not returned to the bridge before the timeout or because an error occurred. Should be the same length as the `errorSources` array and ordered the same. May be omitted if all sources responded without errors."
        }
      },
      "required": ["requestUuid", "responseUuid", "timestamp"],
      "additionalProperties": false
    }
  }
}
