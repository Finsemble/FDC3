{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://fdc3.finos.org/schemas/next/bridging/bridgeResponse.schema.json",
  "title": "bridgeResponse",
  "type": "object",
  "description": "Schema defining the format of all response messages from a the Bridge to the original Desktop Agent that raised a request. Individual message schemas further refine this format for each response type.",
  "allOf": [
    {
      "$ref": "agentResponse.schema.json"
    },
    {
      "type": "object",
      "properties": {
        "type": true,
        "payload": true,
        "meta": {
          "$ref": "#/$defs/BridgeResponseMeta"
        }
      },
      "required": ["type", "payload", "meta"],
      "additionalProperties": false
    }
  ],
  "$defs": {
    "BridgeResponseMeta": {
      "title": "Bridge response metadata",
      "type": "object",
      "allOf": [
        {
          "$ref": "agentResponse.schema.json#/$defs/AgentResponseMeta"
        },
        {
          "type": "object",
          "properties": {
            "requestUuid": true,
            "timestamp": true,
            "responseUuid": true,
            "sources": {
              "title": "Desktop Agents that responded",
              "type": "array",
              "items": {
                "oneOf": [
                  {
                    "$ref": "../api/appIdentifier.schema.json"
                  },
                  {
                    "$ref": "../api/desktopAgentIdentifier.schema.json"
                  }
                ]
              },
              "description": "Array of AppIdentifiers or DesktopAgentIdentifiers for the sources that generated responses to the request. Will contain a single value for individual responses and multiple values for responses that were collated by the bridge. May be omitted if all sources errored."
            },
            "errorSources": {
              "title": "Desktop Agents that returned errors",
              "type": "array",
              "items": {
                "oneOf": [
                  {
                    "$ref": "../api/appIdentifier.schema.json"
                  },
                  {
                    "$ref": "../api/desktopAgentIdentifier.schema.json"
                  }
                ]
              },
              "description": "Array of AppIdentifiers or DesktopAgentIdentifiers for responses that were not returned to the bridge before the timeout or because an error occurred. May be omitted if all sources responded without errors."
            },
            "errorDetails": {
              "title": "Detail of errors returned",
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Array of error message strings for responses that were not returned to the bridge before the timeout or because an error occurred. Should be the same length as the `errorSources` array and ordered the same. May be omitted if all sources responded without errors."
            }
          },
          "required": ["requestUuid", "responseUuid", "timestamp"],
          "additionalProperties": false
        }
      ]
    }
  }
}
